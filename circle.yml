machine:
  node:
    version: 0.10.28

checkout:
  override:
    - git clone $TEST_REPO

dependencies:
  override:
    - cd $TEST_REPO_DIR &&  npm install
    - sh -c "if [ '$HAPI_REPO' ]; then sh -c 'cd $TEST_REPO_DIR/node_modules; rm -r hapi; git clone $HAPI_REPO'; fi"
    - sh -c "if [ '$HAPI_REPO' ] && [ '$HAPI_COMMIT' ]; then sh -c 'cd $TEST_REPO_DIR/node_modules/hapi; git checkout $HAPI_COMMIT'; fi"
    - sh -c "if [ '$HAPI_REPO' ]; then sh -c 'cd $TEST_REPO_DIR/node_modules/hapi; npm install'; fi"
test:
  override:
    - cd $TEST_REPO_DIR && sh -c '$TEST_COMMAND' && cp $REPORT_FILE ../